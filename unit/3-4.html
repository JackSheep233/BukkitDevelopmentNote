<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>配置API的序列化和遍历 | Bukkit Development Note</title>
    <meta name="description" content="A guide to develop Minecraft Server plugins based on Bukkit.">
    <meta name="generator" content="VuePress 1.4.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    
    <link rel="preload" href="/BukkitDevelopmentNote/assets/css/0.styles.306dc64a.css" as="style"><link rel="preload" href="/BukkitDevelopmentNote/assets/js/app.2634dd99.js" as="script"><link rel="preload" href="/BukkitDevelopmentNote/assets/js/2.cc6e75aa.js" as="script"><link rel="preload" href="/BukkitDevelopmentNote/assets/js/23.f53b8e95.js" as="script"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/10.e1cfcf7a.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/11.44efa5f5.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/12.3917c9a1.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/13.848a50a7.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/14.d3d0e1c2.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/15.3d1313bf.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/16.4dd55a1e.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/17.ece6e639.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/18.ac97681d.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/19.396f060b.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/20.90cd3f0c.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/21.f6b39766.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/22.938c6544.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/24.c4052a83.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/25.f7321946.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/26.548249ca.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/27.e2b64422.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/28.ed2628f6.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/29.1c742d23.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/3.c1f93749.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/30.04dcb996.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/31.b2bccbe9.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/32.6ab03692.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/33.222886c9.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/34.fe917ab1.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/35.c3502896.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/36.62f3d555.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/37.39042c08.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/38.d83a6a0c.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/4.2f54bf03.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/5.ec88f9e9.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/6.8d881c35.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/7.4444e5b6.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/8.4b9b39e0.js"><link rel="prefetch" href="/BukkitDevelopmentNote/assets/js/9.c2d8b702.js">
    <link rel="stylesheet" href="/BukkitDevelopmentNote/assets/css/0.styles.306dc64a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/BukkitDevelopmentNote/" class="home-link router-link-active"><!----> <span class="site-name">Bukkit Development Note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/BukkitDevelopmentNote/home.html" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/BukkitDevelopmentNote/contribute.html" class="nav-link">
  贡献
</a></div><div class="nav-item"><a href="https://alpha.tdiant.net/donate.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  赞助
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/tdiant/BukkitDevelopmentNote" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub仓库
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/BukkitDevelopmentNote/home.html" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/BukkitDevelopmentNote/contribute.html" class="nav-link">
  贡献
</a></div><div class="nav-item"><a href="https://alpha.tdiant.net/donate.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  赞助
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/tdiant/BukkitDevelopmentNote" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub仓库
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/BukkitDevelopmentNote/home.html" class="sidebar-link">欢迎</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第一部分: 基本概念</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/BukkitDevelopmentNote/unit/1-1.html" class="sidebar-link">写在前面</a></li><li><a href="/BukkitDevelopmentNote/unit/1-2.html" class="sidebar-link">MC的服务端介绍</a></li><li><a href="/BukkitDevelopmentNote/unit/1-3.html" class="sidebar-link">代码中的MC世界</a></li><li><a href="/BukkitDevelopmentNote/unit/1-4.html" class="sidebar-link">检索需要的信息</a></li><li><a href="/BukkitDevelopmentNote/unit/1-5.html" class="sidebar-link">服务端与客户端</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第二部分: 基础内容</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/BukkitDevelopmentNote/unit/2-1.html" class="sidebar-link">最简单的插件</a></li><li><a href="/BukkitDevelopmentNote/unit/2-2.html" class="sidebar-link">事件的监听</a></li><li><a href="/BukkitDevelopmentNote/unit/2-3.html" class="sidebar-link">配置API</a></li><li><a href="/BukkitDevelopmentNote/unit/2-4.html" class="sidebar-link">命令执行器</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>第三部分: 进阶功能</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/BukkitDevelopmentNote/unit/3-2.html" class="sidebar-link">自定义事件</a></li><li><a href="/BukkitDevelopmentNote/unit/3-3.html" class="sidebar-link">深入plugin.yml</a></li><li><a href="/BukkitDevelopmentNote/unit/3-4.html" class="active sidebar-link">配置API的序列化和遍历</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNote/unit/3-4.html#了解序列化" class="sidebar-link">了解序列化</a></li><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNote/unit/3-4.html#让自定义类型实现序列化与反序列化" class="sidebar-link">让自定义类型实现序列化与反序列化</a></li><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNote/unit/3-4.html#配置片段-configurationsection" class="sidebar-link">配置片段 ConfigurationSection</a></li><li class="sidebar-sub-header"><a href="/BukkitDevelopmentNote/unit/3-4.html#利用getkeys实现遍历" class="sidebar-link">利用getKeys实现遍历</a></li></ul></li><li><a href="/BukkitDevelopmentNote/unit/3-5.html" class="sidebar-link">多线程多任务框架</a></li><li><a href="/BukkitDevelopmentNote/unit/3-6.html" class="sidebar-link">自定义合成表</a></li><li><a href="/BukkitDevelopmentNote/unit/3-7.html" class="sidebar-link">粒子效果和音效播放</a></li><li><a href="/BukkitDevelopmentNote/unit/3-8.html" class="sidebar-link">世界生成器</a></li><li><a href="/BukkitDevelopmentNote/unit/3-9.html" class="sidebar-link">Title、Bar与计分板显示</a></li><li><a href="/BukkitDevelopmentNote/unit/3-10.html" class="sidebar-link">经验和成就</a></li><li><a href="/BukkitDevelopmentNote/unit/3-11.html" class="sidebar-link">插件系统基本玩法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第四部分: 常用依赖</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/BukkitDevelopmentNote/unit/4-1.html" class="sidebar-link">Vault</a></li><li><a href="/BukkitDevelopmentNote/unit/4-2.html" class="sidebar-link">ProtocolLib</a></li><li><a href="/BukkitDevelopmentNote/unit/4-3.html" class="sidebar-link">Bungeecord</a></li><li><a href="/BukkitDevelopmentNote/unit/4-4.html" class="sidebar-link">PlaceholderAPI</a></li><li><a href="/BukkitDevelopmentNote/unit/4-5.html" class="sidebar-link">VexView</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第五部分: 底层部分</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/BukkitDevelopmentNote/unit/5-1.html" class="sidebar-link">认识NMS与OBC</a></li><li><a href="/BukkitDevelopmentNote/unit/5-2.html" class="sidebar-link">自定义发包</a></li><li><a href="/BukkitDevelopmentNote/unit/5-3.html" class="sidebar-link">NBT数据操作</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="配置api的序列化和遍历"><a href="#配置api的序列化和遍历" class="header-anchor">#</a> 配置API的序列化和遍历</h1> <h1 id="序列化"><a href="#序列化" class="header-anchor">#</a> 序列化</h1> <h2 id="了解序列化"><a href="#了解序列化" class="header-anchor">#</a> 了解序列化</h2> <p>如果我自己做了一个类型, 例如下面的<code>BakaRua</code>类:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BakaRua</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> str<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">BakaRua</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>str <span class="token operator">=</span> str<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>现在我们新建一个BakaRua对象:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">BakaRua</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BakaRua</span><span class="token punctuation">(</span><span class="token string">&quot;tdiant&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>我们想把test保存在配置文件里怎么办?<br>
很遗憾,<code>getConfig().set(&quot;demo&quot;,test);</code>是行不通的. 你会发现<code>getConfig.get(&quot;demo&quot;)</code>根本得不到这个对象.</p> <blockquote><p>哪些东西可以直接set保存呢?
类似getInt, 所有拥有get方法的类型都可以直接保存. (包括<code>List&lt;String&gt;</code>)</p> <p>还有一些BukkitAPI给的类型, 例如ItemStack. 但不是全部都是这样.<br>
如果你想判断一个类型是不是可以直接set, 你可以在JavaDoc中找到它, 看它是否实现了ConfigurationSerializable类.</p></blockquote> <p>你可能想到了最简单粗暴的办法:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//这样set</span>
<span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;demo.name&quot;</span><span class="token punctuation">,</span>test<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;demo.str&quot;</span><span class="token punctuation">,</span>test<span class="token punctuation">.</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//然后保存, 用的时候这样</span>
<span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;demo.name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;demo.str&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这的确是一种切实可行的办法. 但是这真的是太麻烦了. 有没有一种方法直接set test这个对象, 直接get就得到这个对象的办法呢? 有! 你可以使用序列化和反序列化实现它!</p> <h2 id="让自定义类型实现序列化与反序列化"><a href="#让自定义类型实现序列化与反序列化" class="header-anchor">#</a> 让自定义类型实现序列化与反序列化</h2> <p>以上文<code>BakaRua</code>为例. 首先让他实现<code>ConfigurationSerializable</code>, 并添加<code>deserialize</code>方法. 如下:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BakaRua</span> <span class="token keyword">implements</span> <span class="token class-name">ConfigurationSerializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> str<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">BakaRua</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>str <span class="token operator">=</span> str<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">BakaRua</span> <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后继续完善<code>serialize</code>, 实现序列化. 我们只需要把需要保存的数据写入map当中即可.<br>
注意, 需要保存的数据要保证可以直接set, 不能则也需要为他实现序列化与反序列化.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;str&quot;</span><span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> map<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>序列化后, 数据即可直接set进配置文件里. 为了实现直接get的目的, 还需要进行反序列化.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">BakaRua</span> <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BakaRua</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;str&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;str&quot;</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>编写完毕后, 我们需要像注册监听器一样, 注册序列化. 在插件主类的<code>onEnable</code>中加入如下语句:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ConfigurationSerialization</span><span class="token punctuation">.</span><span class="token function">registerClass</span><span class="token punctuation">(</span><span class="token class-name">BakaRua</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>至此, 你就可以自由地对一个自定义的对象直接地get和set了!</p> <h1 id="配置文件的遍历"><a href="#配置文件的遍历" class="header-anchor">#</a> 配置文件的遍历</h1> <p>试想, 如果存在下面的配置文件:</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">demo_list</span><span class="token punctuation">:</span>
   <span class="token key atrule">a</span><span class="token punctuation">:</span> <span class="token number">1</span>
   <span class="token key atrule">b</span><span class="token punctuation">:</span> <span class="token number">233</span>
   <span class="token key atrule">c</span><span class="token punctuation">:</span> <span class="token number">666</span>
   <span class="token key atrule">d</span><span class="token punctuation">:</span> lalalalalal
</code></pre></div><p>我应该如何对<code>demo_list</code>的子键进行遍历, 得到所有子键的对应值?<br>
最简单错报的方式就是将<code>demo_list.a</code>键、<code>demo_list.b</code>键...依次读取. 但这是建立在你知道<code>demo_list</code>有<code>a</code>、<code>b</code>、<code>c</code>...这些子键的基础之上的.<br>
如果我事先不知道<code>demo_list</code>的子键都各自叫什么, 又应应该如何对<code>demo_list</code>的子键进行遍历, 得到所有子键的对应值?</p> <h2 id="配置片段-configurationsection"><a href="#配置片段-configurationsection" class="header-anchor">#</a> 配置片段 ConfigurationSection</h2> <p>我们可以把<code>demo_list</code>键对应的部分拆出来.<br> <em>下文假设config对象是我们现在正在操作的FileConfiguration对象.</em></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ConfigurationSection</span> cs <span class="token operator">=</span> config<span class="token punctuation">.</span>getConfigurationSection​<span class="token punctuation">(</span><span class="token string">&quot;demo_list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这里我们得到了<code>ConfigurationSection</code>对象, 这个对象可以当做config对象<code>demo_list</code>键部分的片段, 等效于这个yaml数据:</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">a</span><span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token key atrule">b</span><span class="token punctuation">:</span> <span class="token number">233</span>
<span class="token key atrule">c</span><span class="token punctuation">:</span> <span class="token number">666</span>
<span class="token key atrule">d</span><span class="token punctuation">:</span> lalalalalal
</code></pre></div><p>对于一个<code>ConfigurationSection</code>对象, 其代表着一个完整配置数据的某个片段, 你不能利用诸如<code>saveConfig</code>的方式保存这个片段到另外一个yml文件里.</p> <h2 id="利用getkeys实现遍历"><a href="#利用getkeys实现遍历" class="header-anchor">#</a> 利用getKeys实现遍历</h2> <p>在上面我们得到了<code>ConfigurationSection</code>对象, 这代表着config对象<code>demo_list</code>键部分的片段.<br>
现在问题转化成了, 如何获取到<code>ConfigurationSection</code>对象里的所有键.<br>
可以利用<code>getKeys(false)</code>的方式达到目的.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> cs<span class="token punctuation">.</span><span class="token function">getKeys</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>key <span class="token operator">+</span> <span class="token string">&quot; = &quot;</span> <span class="token operator">+</span> cs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面的代码将输出:</p> <div class="language- extra-class"><pre class="language-text"><code>a = 1
b = 233
c = 666
d = lalalalalal
</code></pre></div><p>这样就实现了遍历.</p> <p><code>getKeys</code>方法不只是<code>ConfigurationSection</code>拥有, 根据其继承关系, 我们可以推知对<code>FileConfiguration</code>类也拥有<code>getKeys</code>方法, 同理, <code>ConfigurationSection</code>类也有<code>getConfigurationSection​</code>方法.</p> <p>但是我们刚才为什么要给<code>getKeys</code>的一个<code>false</code>的参数呢? 请看下面的yaml数据:</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">test</span><span class="token punctuation">:</span>
  <span class="token key atrule">a</span><span class="token punctuation">:</span>
    <span class="token key atrule">b</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">c</span><span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token key atrule">d</span><span class="token punctuation">:</span> <span class="token number">1</span>
</code></pre></div><p>我们得到了这个配置文件的<code>FileConfiguration</code>对象<code>config</code>, 现在对其用<code>getKeys(false)</code>进行遍历, 得到所有键.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> config<span class="token punctuation">.</span><span class="token function">getKeys</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;===================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> config<span class="token punctuation">.</span><span class="token function">getKeys</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>输出结果如下:</p> <div class="language- extra-class"><pre class="language-text"><code>test
d
===================
test
test.a
test.a.b
test.c
d
</code></pre></div><p>由此可知, <code>getKeys(false)</code>只能获取“一层的键”, 不能递归获取配置文件里所有的键. 而<code>getKeys(true)</code>会递归获取配置文件里所有出现的键.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/BukkitDevelopmentNote/unit/3-3.html" class="prev">
        深入plugin.yml
      </a></span> <span class="next"><a href="/BukkitDevelopmentNote/unit/3-5.html">
        多线程多任务框架
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/BukkitDevelopmentNote/assets/js/app.2634dd99.js" defer></script><script src="/BukkitDevelopmentNote/assets/js/2.cc6e75aa.js" defer></script><script src="/BukkitDevelopmentNote/assets/js/23.f53b8e95.js" defer></script>
  </body>
</html>
